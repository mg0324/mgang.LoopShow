var mgang ={
	loopShowId : 0,
	itemDivCount : 0,
	loopDelay : 0,
	leftBtnId : 0,
	rightBtnId : 0,
	itemClsPrefix : 0,
	itemIdPrefix : 0,
	numNavId : 0,
    numNavAlign : 0,
    startItemIndex : 0,
    numNavLiBgColor : 0
}
function flowRight(){
	var visId = $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").attr("id");
    $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").css("visibility","hidden").attr("show","false");
	visId = parseInt(visId.charAt(7));
	if(visId == mgang.itemDivCount){
		visId = 1;
	}else{
		visId = visId + 1;
	}
	$(mgang.itemIdPrefix + visId).css("visibility","visible").attr("show","true");
   $(mgang.loopShowId).trigger("nextflow");

}
jQuery.fn.extend({
    loopShow : function(options){
        var defaults = {
            loopShowId : $(this).attr("id"),
            loopDelay : 3000,
            leftBtnId : "leftLink",
            rightBtnId : "rightLink",
            itemClsPrefix : "ls_item",
            itemIdPrefix : "ls_item",
            numNavId : "numNav",
            numNavAlign : "topRight",
            startItemIndex : 1,
            numNavLiBgColor : "green"
        };
        var option = $.extend(defaults, options);
        mgang.loopDelay = option.loopDelay ;
        mgang.loopShowId = "#" + option.loopShowId;
        mgang.leftBtnId = "#" + option.leftBtnId;
        mgang.rightBtnId = "#" + option.rightBtnId;
        mgang.itemClsPrefix = "." + option.itemClsPrefix;
        mgang.itemIdPrefix = "#" + option.itemIdPrefix;
        mgang.numNavId = "#" + option.numNavId;
        mgang.numNavAlign = option.numNavAlign;
        mgang.startItemIndex = option.startItemIndex;
        mgang.numNavLiBgColor = option.numNavLiBgColor;
        mgang.itemDivCount = $(mgang.loopShowId + " " + mgang.itemClsPrefix).size();
        $(mgang.itemIdPrefix + mgang.startItemIndex).css("visibility","visible").attr("show","true");
        $(mgang.leftBtnId).hide();
        $(mgang.rightBtnId).hide();
        return $(this);
    },
	initLeftRightLink : function(){
		$(mgang.leftBtnId).css({
			"margin-top" : parseInt($(mgang.loopShowId).css("height"))/2 - 10,
			"left" : "20px"
		}).show().on("click",function(){
            var visId = $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").attr("id");
            $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").css("visibility","hidden").attr("show","false");
            visId = parseInt(visId.charAt(7));
            if(visId == 1){
                visId = mgang.itemDivCount;
            }else{
                visId = visId - 1;
            }
            $(mgang.itemIdPrefix + visId).css("visibility","visible").attr("show","true");
            $(mgang.loopShowId).trigger("nextflow");
        });

		$(mgang.rightBtnId).css({
			"margin-top" : parseInt($(mgang.loopShowId).css("height"))/2 - 10,
			"left" : parseInt($(mgang.loopShowId).css("width")) - 40
		}).show().on("click",function(){
            var visId = $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").attr("id");
            $(mgang.loopShowId + " " + mgang.itemClsPrefix + "[show='true']").css("visibility","hidden").attr("show","false");
            visId = parseInt(visId.charAt(7));
            if(visId == mgang.itemDivCount){
                visId = 1;
            }else{
                visId = visId + 1;
            }
            $(mgang.itemIdPrefix + visId).css("visibility","visible").attr("show","true");
            $(mgang.loopShowId).trigger("nextflow");
        });
		return $(this);	
	},
	initNumNav : function(numNavAlign){
        var align = "";
        if(numNavAlign){
            align = numNavAlign;
        }else{
            align = mgang.numNavAlign;
        }
        if(align == "bottomRight"){
            for(var i = 1;i <= mgang.itemDivCount; i++){
                $("<li>" + i +"</li>").on("click",function(){
                    var shouldShow = $(this).html();
                    $(mgang.loopShowId + " " + mgang.itemClsPrefix).css("visibility","hidden").attr("show","false");
                    $(mgang.itemIdPrefix + shouldShow).attr("show","true").css("visibility","visible");
                    $(mgang.loopShowId).trigger("nextflow");
                }).prependTo($(mgang.numNavId)).css({
                        "margin-top" : parseInt($(mgang.loopShowId).css("height")) - 40
                });
            }
        }else{
            for(var i = 1;i <= mgang.itemDivCount; i++){
                $("<li>" + i +"</li>").bind("click",function(){
                    var shouldShow = $(this).html();
                    $(mgang.loopShowId + " " + mgang.itemClsPrefix).css("visibility","hidden").attr("show","false");
                    $(mgang.itemIdPrefix + shouldShow).attr("show","true").css("visibility","visible");
                    $(mgang.loopShowId).trigger("nextflow");
                }).prependTo($(mgang.numNavId));
            }
        }
        $(mgang.numNavId +" li").eq(-mgang.startItemIndex).css("background-color",mgang.numNavLiBgColor);
        $(mgang.loopShowId).on("nextflow",function(){
            $(mgang.numNavId + " li").each(function(index,domObj){
                var id = parseInt($(mgang.loopShowId +" " + mgang.itemClsPrefix + "[show='true']").attr("id").charAt(7));
                var liText = parseInt($(domObj).text());
                if(liText == id){
                    $(domObj).css("background-color",mgang.numNavLiBgColor);
                }else{
                    $(domObj).css("background-color","gray");
                }
            });
        });
		return $(this);	
	},
	startLoopShow : function(){
		var loopHandler;
		$(mgang.loopShowId).on("mouseover",function(){
			clearInterval(loopHandler);
		}).on("mouseout",function(){
			loopHandler = setInterval(flowRight,mgang.loopDelay);
		});
		loopHandler = setInterval(flowRight,mgang.loopDelay);
		return $(this);		
	}
});